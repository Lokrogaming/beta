<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HMCBH – Lite</title>
<style>
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#0c0f16;color:#e7f2f5;display:flex;justify-content:center;padding:40px}
  .box{width:100%;max-width:700px;background:#111726;padding:24px;border-radius:14px;box-shadow:0 0 30px rgba(0,0,0,0.4)}
  h1{text-align:center;margin-top:0;color:#7afcff}
  input{width:96%;padding:12px;border-radius:8px;border:1px solid #2a334a;background:#0c1220;color:white;font-size:16px;margin-top:10px}
  button{width:100%;padding:12px;margin-top:14px;border:none;border-radius:8px;background:#00e0ff;color:#00131a;font-weight:bold;font-size:16px;cursor:pointer}
  #loading{margin-top:10px;font-size:14px;color:#9ac7d1;display:none}
  #resultsBox{margin-top:20px;display:none;background:#141b2d;padding:16px;border-radius:10px}
  .found{background:#0f443a;padding:8px;border-radius:6px;margin-bottom:8px}
  .notfound{background:#442222;padding:8px;border-radius:6px;margin-bottom:8px}
</style>
</head>
<body>
<div class="box">
  <h1>HMCBH</h1>
  <input type="password" id="query" placeholder="Passwort oder Username eingeben..." autocomplete="off" />
  <button id="start">Check starten</button>
  <div id="loading">Lade Listen...</div>

  <div id="resultsBox">
    <h3>Ergebnisse</h3>
    <div id="results"></div>
  </div>
</div>

<script>
const startBtn = document.getElementById('start');
const queryInput = document.getElementById('query');
const loading = document.getElementById('loading');
const resultsBox = document.getElementById('resultsBox');
const results = document.getElementById('results');

// Basis-URL deines SecLists-Forks
const BASE = "";

async function fetchJSON(path){
  const r = await fetch(BASE + path);
  if(!r.ok) throw new Error("JSON konnte nicht geladen werden: " + path);
  return r.json();
}

async function streamSearch(url, needle){
  const r = await fetch(url);
  if(!r.ok) return {file:url, error:true};

  const reader = r.body.getReader();
  const decoder = new TextDecoder();
  let remainder = "";
  let line = 0;
  const lowerN = needle.toLowerCase();
  let hits = [];

  while(true){
    const {value,done} = await reader.read();
    if(done) break;
    const text = decoder.decode(value, {stream:true});
    const parts = (remainder + text).split(/\n/);
    remainder = parts.pop();

    for(const p of parts){
      line++;
      if(p.toLowerCase().includes(lowerN)){
        hits.push({line, match:p});
      }
    }
  }

  if(remainder){
    line++;
    if(remainder.toLowerCase().includes(lowerN)){
      hits.push({line, match:remainder});
    }
  }

  return {file:url, hits};
}

startBtn.onclick = async ()=>{
  const q = queryInput.value.trim();
  if(!q) return;

  loading.style.display = 'block';
  resultsBox.style.display = 'none';
  results.innerHTML = '';

  try{
    const pwFiles = await fetchJSON("JSON/pwFiles.json");
    const unFiles = await fetchJSON("JSON/unFiles.json");

   // JSON hat folgendes Format:
// { lists: [ { name, path }, ... ] }

const fileList = [...pwFiles.lists, ...unFiles.lists];

let allResults = [];

for (const file of fileList) {
  const url = file.path; // bereits vollständige URL!
  const res = await streamSearch(url, q);

  allResults.push({
    file: file.name,
    hits: res.hits,
    error: res.error
  });
}


    loading.style.display = 'none';
    resultsBox.style.display = 'block';

    let anyHit = false;
    for(const r of allResults){
      if(r.error){
        results.innerHTML += `<div class='notfound'><b>${r.file}</b><br>Fehler beim Laden.</div>`;
        continue;
      }

      if(r.hits.length > 0){
        anyHit = true;
        let hitLines = r.hits.map(h=>`Zeile ${h.line}: ${h.match}`).join('<br>');
        results.innerHTML += `<div class='found'><b>${r.file}</b><br>${hitLines}</div>`;
      } else {
        results.innerHTML += `<div class='notfound'><b>${r.file}</b><br>Keine Treffer</div>`;
      }
    }

    if(!anyHit){
      results.innerHTML = "<div class='notfound'>Keine Treffer in allen Listen.</div>";
    }

  } catch(e){
    loading.style.display = 'none';
    alert("Fehler: " + e.message);
  }
};
</script>
</body>
</html>

